<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{common/_header :: common_header(pageTitle=${pageTitle})}"></head>
<body>
<div class="content-wrapper">
  <div class="container page-content">
    <h2 th:text="${pageTitle}">表单</h2>

    <!-- Flash Messages for success/error (如果直接返回此页面而不是重定向) -->
    <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>

    <!-- 修改点在这里：th:action="@{${formAction}}" -->
    <form th:action="@{${formAction}}" th:object="${department}" method="post" class="needs-validation" novalidate>
      <!-- 如果是编辑模式，可以包含一个隐藏的ID字段，但通常ID在URL中，且deptId已在对象中 -->
      <!-- <input type="hidden" th:if="${isEdit}" th:field="*{deptId}" /> -->

      <div class="mb-3">
        <label for="deptName" class="form-label">部门名称:</label>
        <input type="text" id="deptName" th:field="*{deptName}" class="form-control" required />
        <!-- 可以添加Thymeleaf的错误显示，如果后端校验失败并返回到此页面 -->
        <!-- <div th:if="${#fields.hasErrors('deptName')}" th:errors="*{deptName}" class="invalid-feedback d-block"></div> -->
        <div class="invalid-feedback">部门名称不能为空。</div>
      </div>

      <div class="mb-3">
        <label for="deptRemark" class="form-label">部门备注:</label>
        <textarea id="deptRemark" th:field="*{deptRemark}" class="form-control" rows="3"></textarea>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-success" th:text="${isEdit} ? '更新部门' : '添加部门'"></button>
        <a th:href="@{/departments/list}" class="btn btn-secondary">取消</a>
      </div>
    </form>
  </div>
</div>
<div th:replace="~{common/_footer :: common_footer}"></div>

<script>
  // 简单的Bootstrap表单验证激活 (如果使用了Bootstrap)
  (function () {
    'use strict'
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms)
            .forEach(function (form) {
              form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                  event.preventDefault()
                  event.stopPropagation()
                }
                form.classList.add('was-validated')
              }, false)
            })
  })()
</script>
</body>
</html>