<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- 1. 引入头部元信息和CSS (来自 common/_header.html 的 page_head 片段) -->
<head th:replace="~{common/_header :: page_head(pageTitleParam=${pageTitle})}"></head>

<body>
<!-- 2. 引入导航栏 (来自 common/_header.html 的 main_navbar 片段) -->
<div th:replace="~{common/_header :: main_navbar}"></div>

<!-- 页面主要内容区域 -->
<div class="main-container"> <!-- 这个 div 包裹主要内容 -->
  <div class="content-wrapper">
    <div class="container page-content">
      <h2 th:text="${pageTitle}">员工列表</h2>

      <div th:if="${successMessage}" class="alert alert-success" role="alert" th:text="${successMessage}"></div>
      <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>

      <!-- 搜索表单 -->
      <form th:action="@{/employees/list}" method="get" class="mb-3 search-form">
        <div class="row g-3 align-items-end">
          <div class="col-md-2">
            <label for="searchEmpName" class="form-label">姓名:</label>
            <input type="text" id="searchEmpName" name="empName"
                   th:value="${searchParams != null and searchParams['empName'] != null ? searchParams['empName'] : ''}"
                   class="form-control form-control-sm">
          </div>
          <div class="col-md-2">
            <label for="searchEmpPhone" class="form-label">电话:</label>
            <input type="text" id="searchEmpPhone" name="empPhone"
                   th:value="${searchParams != null and searchParams['empPhone'] != null ? searchParams['empPhone'] : ''}"
                   class="form-control form-control-sm">
          </div>
          <div class="col-md-2">
            <label for="searchDeptId" class="form-label">部门:</label>
            <select id="searchDeptId" name="deptId" class="form-select form-select-sm">
              <option value="">--所有部门--</option>
              <option th:each="dept : ${departments}" th:value="${dept.deptId}" th:text="${dept.deptName}"
                      th:selected="${searchParams != null and searchParams['deptId'] != null and searchParams['deptId'] == dept.deptId}"></option>
            </select>
          </div>
          <div class="col-md-2">
            <label for="searchJobId" class="form-label">岗位:</label>
            <select id="searchJobId" name="jobId" class="form-select form-select-sm">
              <option value="">--所有岗位--</option>
              <option th:each="job : ${jobs}" th:value="${job.jobId}" th:text="${job.jobName}"
                      th:selected="${searchParams != null and searchParams['jobId'] != null and searchParams['jobId'] == job.jobId}"></option>
            </select>
          </div>
          <div class="col-md-2">
            <label for="searchEmpSex" class="form-label">性别:</label>
            <select id="searchEmpSex" name="empSex" class="form-select form-select-sm">
              <option value="">--所有--</option>
              <option value="1" th:selected="${searchParams != null and searchParams['empSex'] != null and searchParams['empSex'] == 1}">男</option>
              <option value="2" th:selected="${searchParams != null and searchParams['empSex'] != null and searchParams['empSex'] == 2}">女</option>
            </select>
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-info btn-sm w-100">搜索</button>
          </div>
        </div>
      </form>

      <div class="action-buttons-bar mb-3"> <!-- 统一操作按钮的容器 -->
        <a th:href="@{/employees/add}" class="btn btn-primary">添加新员工</a>
        <a th:href="@{/}" class="btn btn-info ms-2">返回首页</a> <!-- 添加返回首页按钮 -->
      </div>

      <table class="table table-striped table-bordered table-hover">
        <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>姓名</th>
          <th>性别</th>
          <th>电话</th>
          <th>身份证号</th>
          <th>部门</th>
          <th>岗位</th>
          <th>入职日期</th>
          <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="emp : ${employees}" th:if="${!#lists.isEmpty(employees)}">
          <td th:text="${emp.empId}">1</td>
          <td th:text="${emp.empName}">张三</td>
          <td th:text="${emp.empSex == 1 ? '男' : (emp.empSex == 2 ? '女' : '未知')}">男</td>
          <td th:text="${emp.empPhone}">13800138000</td>
          <td th:text="${emp.empCardId}">440...</td>
          <td th:text="${emp.department?.deptName}">技术部</td>
          <td th:text="${emp.job?.jobName}">工程师</td>
          <td th:text="${emp.empCreateDate != null ? #dates.format(emp.empCreateDate, 'yyyy-MM-dd') : ''}">2023-01-01</td>
          <td>
            <a th:href="@{/employees/edit/{id}(id=${emp.empId})}" class="btn btn-sm btn-warning">编辑</a>
            <a th:href="@{/employees/delete/{id}(id=${emp.empId})}"
               class="btn btn-sm btn-danger delete-employee-link"
               th:attr="data-confirm-message='确定要删除员工 “' + ${emp.empName} + '” 吗？'">删除</a>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(employees)}">
          <td colspan="9" class="text-center">暂无员工信息</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div> <!-- main-container 结束 -->

<!-- 3. 引入页脚 -->
<div th:replace="~{common/_footer :: common_footer}"></div>

<script th:inline="javascript">
  /*<![CDATA[*/
  document.addEventListener('DOMContentLoaded', function() {
    const deleteEmployeeLinks = document.querySelectorAll('a.delete-employee-link');
    deleteEmployeeLinks.forEach(link => {
      link.addEventListener('click', function(event) {
        const confirmMessage = this.getAttribute('data-confirm-message');
        if (!confirm(confirmMessage)) {
          event.preventDefault();
        }
      });
    });
  });
  /*]]>*/
</script>
</body>
</html>